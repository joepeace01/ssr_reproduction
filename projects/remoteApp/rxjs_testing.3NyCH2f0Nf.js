import{__extends as rt,__read as he,__spreadArray as ve,__values as be}from"tslib";import{__extends as jr}from"tslib";function l(t){return typeof t=="function"}import{__read as Pr,__spreadArray as Lr,__values as Cr}from"tslib";function $(t){var e=function(n){Error.call(n),n.stack=new Error().stack},r=t(e);return r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,r}var X=$(function(t){return function(r){t(this),this.message=r?r.length+` errors occurred during unsubscription:
`+r.map(function(n,o){return o+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=r}});function P(t,e){if(t){var r=t.indexOf(e);0<=r&&t.splice(r,1)}}var g=function(){function t(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var e,r,n,o,i;if(!this.closed){this.closed=!0;var a=this._parentage;if(a)if(this._parentage=null,Array.isArray(a))try{for(var s=Cr(a),u=s.next();!u.done;u=s.next()){var f=u.value;f.remove(this)}}catch(m){e={error:m}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(e)throw e.error}}else a.remove(this);var c=this.initialTeardown;if(l(c))try{c()}catch(m){i=m instanceof X?m.errors:[m]}var d=this._finalizers;if(d){this._finalizers=null;try{for(var p=Cr(d),v=p.next();!v.done;v=p.next()){var h=v.value;try{Mr(h)}catch(m){i=i??[],m instanceof X?i=Lr(Lr([],Pr(i)),Pr(m.errors)):i.push(m)}}}catch(m){n={error:m}}finally{try{v&&!v.done&&(o=p.return)&&o.call(p)}finally{if(n)throw n.error}}}if(i)throw new X(i)}},t.prototype.add=function(e){var r;if(e&&e!==this)if(this.closed)Mr(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(r=this._finalizers)!==null&&r!==void 0?r:[]).push(e)}},t.prototype._hasParent=function(e){var r=this._parentage;return r===e||Array.isArray(r)&&r.includes(e)},t.prototype._addParent=function(e){var r=this._parentage;this._parentage=Array.isArray(r)?(r.push(e),r):r?[r,e]:e},t.prototype._removeParent=function(e){var r=this._parentage;r===e?this._parentage=null:Array.isArray(r)&&P(r,e)},t.prototype.remove=function(e){var r=this._finalizers;r&&P(r,e),e instanceof t&&e._removeParent(this)},t.EMPTY=function(){var e=new t;return e.closed=!0,e}(),t}();var yr=g.EMPTY;function J(t){return t instanceof g||t&&"closed"in t&&l(t.remove)&&l(t.add)&&l(t.unsubscribe)}function Mr(t){l(t)?t():t.unsubscribe()}var I={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};import{__read as Ur,__spreadArray as Nr}from"tslib";var F={setTimeout:function(t,e){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var o=F.delegate;return o?.setTimeout?o.setTimeout.apply(o,Nr([t,e],Ur(r))):setTimeout.apply(void 0,Nr([t,e],Ur(r)))},clearTimeout:function(t){var e=F.delegate;return(e?.clearTimeout||clearTimeout)(t)},delegate:void 0};function Q(t){F.setTimeout(function(){var e=I.onUnhandledError;if(e)e(t);else throw t})}function xr(){}var L=function(){return gr("C",void 0,void 0)}();function C(t){return gr("E",void 0,t)}function M(t){return gr("N",t,void 0)}function gr(t,e,r){return{kind:t,value:e,error:r}}var U=null;function R(t){if(I.useDeprecatedSynchronousErrorHandling){var e=!U;if(e&&(U={errorThrown:!1,error:null}),t(),e){var r=U,n=r.errorThrown,o=r.error;if(U=null,n)throw o}}else t()}function Rr(t){I.useDeprecatedSynchronousErrorHandling&&U&&(U.errorThrown=!0,U.error=t)}var D=function(t){jr(e,t);function e(r){var n=t.call(this)||this;return n.isStopped=!1,r?(n.destination=r,J(r)&&r.add(n)):n.destination=Ee,n}return e.create=function(r,n,o){return new Z(r,n,o)},e.prototype.next=function(r){this.isStopped?Sr(M(r),this):this._next(r)},e.prototype.error=function(r){this.isStopped?Sr(C(r),this):(this.isStopped=!0,this._error(r))},e.prototype.complete=function(){this.isStopped?Sr(L,this):(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(r){this.destination.next(r)},e.prototype._error=function(r){try{this.destination.error(r)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(g);var ge=Function.prototype.bind;function wr(t,e){return ge.call(t,e)}var we=function(){function t(e){this.partialObserver=e}return t.prototype.next=function(e){var r=this.partialObserver;if(r.next)try{r.next(e)}catch(n){W(n)}},t.prototype.error=function(e){var r=this.partialObserver;if(r.error)try{r.error(e)}catch(n){W(n)}else W(e)},t.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(r){W(r)}},t}(),Z=function(t){jr(e,t);function e(r,n,o){var i=t.call(this)||this,a;if(l(r)||!r)a={next:r??void 0,error:n??void 0,complete:o??void 0};else{var s;i&&I.useDeprecatedNextContext?(s=Object.create(r),s.unsubscribe=function(){return i.unsubscribe()},a={next:r.next&&wr(r.next,s),error:r.error&&wr(r.error,s),complete:r.complete&&wr(r.complete,s)}):a=r}return i.destination=new we(a),i}return e}(D);function W(t){I.useDeprecatedSynchronousErrorHandling?Rr(t):Q(t)}function Se(t){throw t}function Sr(t,e){var r=I.onStoppedNotification;r&&F.setTimeout(function(){return r(t,e)})}var Ee={closed:!0,next:xr,error:Se,complete:xr};var j=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function qr(t){return t}function Vr(t){return t.length===0?qr:t.length===1?t[0]:function(r){return t.reduce(function(n,o){return o(n)},r)}}var b=function(){function t(e){e&&(this._subscribe=e)}return t.prototype.lift=function(e){var r=new t;return r.source=this,r.operator=e,r},t.prototype.subscribe=function(e,r,n){var o=this,i=Ie(e)?e:new Z(e,r,n);return R(function(){var a=o,s=a.operator,u=a.source;i.add(s?s.call(i,u):u?o._subscribe(i):o._trySubscribe(i))}),i},t.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(r){e.error(r)}},t.prototype.forEach=function(e,r){var n=this;return r=Yr(r),new r(function(o,i){var a=new Z({next:function(s){try{e(s)}catch(u){i(u),a.unsubscribe()}},error:i,complete:o});n.subscribe(a)})},t.prototype._subscribe=function(e){var r;return(r=this.source)===null||r===void 0?void 0:r.subscribe(e)},t.prototype[j]=function(){return this},t.prototype.pipe=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return Vr(e)(this)},t.prototype.toPromise=function(e){var r=this;return e=Yr(e),new e(function(n,o){var i;r.subscribe(function(a){return i=a},function(a){return o(a)},function(){return n(i)})})},t.create=function(e){return new t(e)},t}();function Yr(t){var e;return(e=t??I.Promise)!==null&&e!==void 0?e:Promise}function _e(t){return t&&l(t.next)&&l(t.error)&&l(t.complete)}function Ie(t){return t&&t instanceof D||_e(t)&&J(t)}import{__extends as He}from"tslib";var N=function(){function t(e,r){r===void 0&&(r=1/0),this.subscribedFrame=e,this.unsubscribedFrame=r}return t}();var K=function(){function t(){this.subscriptions=[]}return t.prototype.logSubscribedFrame=function(){return this.subscriptions.push(new N(this.scheduler.now())),this.subscriptions.length-1},t.prototype.logUnsubscribedFrame=function(e){var r=this.subscriptions,n=r[e];r[e]=new N(n.subscribedFrame,this.scheduler.now())},t}();function rr(t,e){for(var r=0,n=e.length;r<n;r++)for(var o=e[r],i=Object.getOwnPropertyNames(o.prototype),a=0,s=i.length;a<s;a++){var u=i[a];t.prototype[u]=o.prototype[u]}}var Dr=new b(function(t){return t.complete()});function Hr(t){return t&&l(t.schedule)}function Te(t){return t[t.length-1]}function Br(t){return Hr(Te(t))?t.pop():void 0}import{__asyncValues as ke,__awaiter as Pe,__generator as Le,__values as Ce}from"tslib";var er=function(t){return t&&typeof t.length=="number"&&typeof t!="function"};function tr(t){return l(t?.then)}function nr(t){return l(t[j])}function or(t){return Symbol.asyncIterator&&l(t?.[Symbol.asyncIterator])}function ir(t){return new TypeError("You provided "+(t!==null&&typeof t=="object"?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function Ae(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var ar=Ae();function sr(t){return l(t?.[ar])}import{__asyncGenerator as Fe,__await as Er,__generator as Oe}from"tslib";function ur(t){return Fe(this,arguments,function(){var r,n,o,i;return Oe(this,function(a){switch(a.label){case 0:r=t.getReader(),a.label=1;case 1:a.trys.push([1,,9,10]),a.label=2;case 2:return[4,Er(r.read())];case 3:return n=a.sent(),o=n.value,i=n.done,i?[4,Er(void 0)]:[3,5];case 4:return[2,a.sent()];case 5:return[4,Er(o)];case 6:return[4,a.sent()];case 7:return a.sent(),[3,2];case 8:return[3,10];case 9:return r.releaseLock(),[7];case 10:return[2]}})})}function cr(t){return l(t?.getReader)}function q(t){if(t instanceof b)return t;if(t!=null){if(nr(t))return Me(t);if(er(t))return Ue(t);if(tr(t))return Ne(t);if(or(t))return Gr(t);if(sr(t))return Re(t);if(cr(t))return je(t)}throw ir(t)}function Me(t){return new b(function(e){var r=t[j]();if(l(r.subscribe))return r.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function Ue(t){return new b(function(e){for(var r=0;r<t.length&&!e.closed;r++)e.next(t[r]);e.complete()})}function Ne(t){return new b(function(e){t.then(function(r){e.closed||(e.next(r),e.complete())},function(r){return e.error(r)}).then(null,Q)})}function Re(t){return new b(function(e){var r,n;try{for(var o=Ce(t),i=o.next();!i.done;i=o.next()){var a=i.value;if(e.next(a),e.closed)return}}catch(s){r={error:s}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}e.complete()})}function Gr(t){return new b(function(e){qe(t,e).catch(function(r){return e.error(r)})})}function je(t){return Gr(ur(t))}function qe(t,e){var r,n,o,i;return Pe(this,void 0,void 0,function(){var a,s;return Le(this,function(u){switch(u.label){case 0:u.trys.push([0,5,6,11]),r=ke(t),u.label=1;case 1:return[4,r.next()];case 2:if(n=u.sent(),!!n.done)return[3,4];if(a=n.value,e.next(a),e.closed)return[2];u.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return s=u.sent(),o={error:s},[3,11];case 6:return u.trys.push([6,,9,10]),n&&!n.done&&(i=r.return)?[4,i.call(r)]:[3,8];case 7:u.sent(),u.label=8;case 8:return[3,10];case 9:if(o)throw o.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function T(t,e,r,n,o){n===void 0&&(n=0),o===void 0&&(o=!1);var i=e.schedule(function(){r(),o?t.add(this.schedule(null,n)):this.unsubscribe()},n);if(t.add(i),!o)return i}function Ve(t){return l(t?.lift)}function fr(t){return function(e){if(Ve(e))return e.lift(function(r){try{return t(r,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}import{__extends as Ye}from"tslib";function zr(t,e,r,n,o){return new De(t,e,r,n,o)}var De=function(t){Ye(e,t);function e(r,n,o,i,a,s){var u=t.call(this,r)||this;return u.onFinalize=a,u.shouldUnsubscribe=s,u._next=n?function(f){try{n(f)}catch(c){r.error(c)}}:t.prototype._next,u._error=i?function(f){try{i(f)}catch(c){r.error(c)}finally{this.unsubscribe()}}:t.prototype._error,u._complete=o?function(){try{o()}catch(f){r.error(f)}finally{this.unsubscribe()}}:t.prototype._complete,u}return e.prototype.unsubscribe=function(){var r;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;t.prototype.unsubscribe.call(this),!n&&((r=this.onFinalize)===null||r===void 0||r.call(this))}},e}(D);function lr(t,e){return e===void 0&&(e=0),fr(function(r,n){r.subscribe(zr(n,function(o){return T(n,t,function(){return n.next(o)},e)},function(){return T(n,t,function(){return n.complete()},e)},function(o){return T(n,t,function(){return n.error(o)},e)}))})}function pr(t,e){return e===void 0&&(e=0),fr(function(r,n){n.add(t.schedule(function(){return r.subscribe(n)},e))})}function $r(t,e){return q(t).pipe(pr(e),lr(e))}function Xr(t,e){return q(t).pipe(pr(e),lr(e))}function Jr(t,e){return new b(function(r){var n=0;return e.schedule(function(){n===t.length?r.complete():(r.next(t[n++]),r.closed||this.schedule())})})}function Qr(t,e){return new b(function(r){var n;return T(r,e,function(){n=t[ar](),T(r,e,function(){var o,i,a;try{o=n.next(),i=o.value,a=o.done}catch(s){r.error(s);return}a?r.complete():r.next(i)},0,!0)}),function(){return l(n?.return)&&n.return()}})}function mr(t,e){if(!t)throw new Error("Iterable cannot be null");return new b(function(r){T(r,e,function(){var n=t[Symbol.asyncIterator]();T(r,e,function(){n.next().then(function(o){o.done?r.complete():r.next(o.value)})},0,!0)})})}function Wr(t,e){return mr(ur(t),e)}function Zr(t,e){if(t!=null){if(nr(t))return $r(t,e);if(er(t))return Jr(t,e);if(tr(t))return Xr(t,e);if(or(t))return mr(t,e);if(sr(t))return Qr(t,e);if(cr(t))return Wr(t,e)}throw ir(t)}function Kr(t,e){return e?Zr(t,e):q(t)}function re(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=Br(t);return Kr(t,r)}function ee(t,e){var r=l(t)?t:function(){return t},n=function(o){return o.error(r())};return new b(e?function(o){return e.schedule(n,0,o)}:n)}var jo=function(){function t(e,r,n){this.kind=e,this.value=r,this.error=n,this.hasValue=e==="N"}return t.prototype.observe=function(e){return H(this,e)},t.prototype.do=function(e,r,n){var o=this,i=o.kind,a=o.value,s=o.error;return i==="N"?e?.(a):i==="E"?r?.(s):n?.()},t.prototype.accept=function(e,r,n){var o;return l((o=e)===null||o===void 0?void 0:o.next)?this.observe(e):this.do(e,r,n)},t.prototype.toObservable=function(){var e=this,r=e.kind,n=e.value,o=e.error,i=r==="N"?re(n):r==="E"?ee(function(){return o}):r==="C"?Dr:0;if(!i)throw new TypeError("Unexpected notification kind "+r);return i},t.createNext=function(e){return new t("N",e)},t.createError=function(e){return new t("E",void 0,e)},t.createComplete=function(){return t.completeNotification},t.completeNotification=new t("C"),t}();function H(t,e){var r,n,o,i=t,a=i.kind,s=i.value,u=i.error;if(typeof a!="string")throw new TypeError("Invalid notification, missing \"kind\"");a==="N"?(r=e.next)===null||r===void 0||r.call(e,s):a==="E"?(n=e.error)===null||n===void 0||n.call(e,u):(o=e.complete)===null||o===void 0||o.call(e)}var dr=function(t){He(e,t);function e(r,n){var o=t.call(this,function(i){var a=this,s=a.logSubscribedFrame(),u=new g;return u.add(new g(function(){a.logUnsubscribedFrame(s)})),a.scheduleMessages(i),u})||this;return o.messages=r,o.subscriptions=[],o.scheduler=n,o}return e.prototype.scheduleMessages=function(r){for(var n=this.messages.length,o=0;o<n;o++){var i=this.messages[o];r.add(this.scheduler.schedule(function(a){var s=a,u=s.message.notification,f=s.subscriber;H(u,f)},i.frame,{message:i,subscriber:r}))}},e}(b);rr(dr,[K]);import{__extends as Ge}from"tslib";import{__extends as oe,__values as Be}from"tslib";var te=$(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}});var _r=function(t){oe(e,t);function e(){var r=t.call(this)||this;return r.closed=!1,r.currentObservers=null,r.observers=[],r.isStopped=!1,r.hasError=!1,r.thrownError=null,r}return e.prototype.lift=function(r){var n=new ne(this,this);return n.operator=r,n},e.prototype._throwIfClosed=function(){if(this.closed)throw new te},e.prototype.next=function(r){var n=this;R(function(){var o,i;if(n._throwIfClosed(),!n.isStopped){n.currentObservers||(n.currentObservers=Array.from(n.observers));try{for(var a=Be(n.currentObservers),s=a.next();!s.done;s=a.next()){var u=s.value;u.next(r)}}catch(f){o={error:f}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(o)throw o.error}}}})},e.prototype.error=function(r){var n=this;R(function(){if(n._throwIfClosed(),!n.isStopped){n.hasError=n.isStopped=!0,n.thrownError=r;for(var o=n.observers;o.length;)o.shift().error(r)}})},e.prototype.complete=function(){var r=this;R(function(){if(r._throwIfClosed(),!r.isStopped){r.isStopped=!0;for(var n=r.observers;n.length;)n.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var r;return((r=this.observers)===null||r===void 0?void 0:r.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(r){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,r)},e.prototype._subscribe=function(r){return this._throwIfClosed(),this._checkFinalizedStatuses(r),this._innerSubscribe(r)},e.prototype._innerSubscribe=function(r){var n=this,o=this,i=o.hasError,a=o.isStopped,s=o.observers;return i||a?yr:(this.currentObservers=null,s.push(r),new g(function(){n.currentObservers=null,P(s,r)}))},e.prototype._checkFinalizedStatuses=function(r){var n=this,o=n.hasError,i=n.thrownError,a=n.isStopped;o?r.error(i):a&&r.complete()},e.prototype.asObservable=function(){var r=new b;return r.source=this,r},e.create=function(r,n){return new ne(r,n)},e}(b);var ne=function(t){oe(e,t);function e(r,n){var o=t.call(this)||this;return o.destination=r,o.source=n,o}return e.prototype.next=function(r){var n,o;(o=(n=this.destination)===null||n===void 0?void 0:n.next)===null||o===void 0||o.call(n,r)},e.prototype.error=function(r){var n,o;(o=(n=this.destination)===null||n===void 0?void 0:n.error)===null||o===void 0||o.call(n,r)},e.prototype.complete=function(){var r,n;(n=(r=this.destination)===null||r===void 0?void 0:r.complete)===null||n===void 0||n.call(r)},e.prototype._subscribe=function(r){var n,o;return(o=(n=this.source)===null||n===void 0?void 0:n.subscribe(r))!==null&&o!==void 0?o:yr},e}(_r);var Ir=function(t){Ge(e,t);function e(r,n){var o=t.call(this)||this;return o.messages=r,o.subscriptions=[],o.scheduler=n,o}return e.prototype._subscribe=function(r){var n=this,o=n.logSubscribedFrame(),i=new g;return i.add(new g(function(){n.logUnsubscribedFrame(o)})),i.add(t.prototype._subscribe.call(this,r)),i},e.prototype.setup=function(){for(var r=this,n=r.messages.length,o=function(a){(function(){var s=r.messages[a],u=s.notification,f=s.frame;r.scheduler.schedule(function(){H(u,r)},f)})()},i=0;i<n;i++)o(i)},e}(_r);rr(Ir,[K]);import{__extends as fe}from"tslib";import{__extends as $e}from"tslib";import{__extends as ze}from"tslib";var ie=function(t){ze(e,t);function e(r,n){return t.call(this)||this}return e.prototype.schedule=function(r,n){return n===void 0&&(n=0),this},e}(g);import{__read as ae,__spreadArray as se}from"tslib";var k={setInterval:function(t,e){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var o=k.delegate;return o?.setInterval?o.setInterval.apply(o,se([t,e],ae(r))):setInterval.apply(void 0,se([t,e],ae(r)))},clearInterval:function(t){var e=k.delegate;return(e?.clearInterval||clearInterval)(t)},delegate:void 0};var ue=function(t){$e(e,t);function e(r,n){var o=t.call(this,r,n)||this;return o.scheduler=r,o.work=n,o.pending=!1,o}return e.prototype.schedule=function(r,n){var o;if(n===void 0&&(n=0),this.closed)return this;this.state=r;var i=this.id,a=this.scheduler;return i!=null&&(this.id=this.recycleAsyncId(a,i,n)),this.pending=!0,this.delay=n,this.id=(o=this.id)!==null&&o!==void 0?o:this.requestAsyncId(a,this.id,n),this},e.prototype.requestAsyncId=function(r,n,o){return o===void 0&&(o=0),k.setInterval(r.flush.bind(r,this),o)},e.prototype.recycleAsyncId=function(r,n,o){if(o===void 0&&(o=0),o!=null&&this.delay===o&&this.pending===!1)return n;n!=null&&k.clearInterval(n)},e.prototype.execute=function(r,n){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var o=this._execute(r,n);if(o)return o;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(r,n){var o=!1,i;try{this.work(r)}catch(a){o=!0,i=a||new Error("Scheduled action threw falsy error")}if(o)return this.unsubscribe(),i},e.prototype.unsubscribe=function(){if(!this.closed){var r=this,n=r.id,o=r.scheduler,i=o.actions;this.work=this.state=this.scheduler=null,this.pending=!1,P(i,this),n!=null&&(this.id=this.recycleAsyncId(o,n,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e}(ie);import{__extends as Xe}from"tslib";var V={now:function(){return(V.delegate||Date).now()},delegate:void 0};var Tr=function(){function t(e,r){r===void 0&&(r=t.now),this.schedulerActionCtor=e,this.now=r}return t.prototype.schedule=function(e,r,n){return r===void 0&&(r=0),new this.schedulerActionCtor(this,e).schedule(n,r)},t.now=V.now,t}();var ce=function(t){Xe(e,t);function e(r,n){n===void 0&&(n=Tr.now);var o=t.call(this,r,n)||this;return o.actions=[],o._active=!1,o}return e.prototype.flush=function(r){var n=this.actions;if(this._active){n.push(r);return}var o;this._active=!0;do if(o=r.execute(r.state,r.delay))break;while(r=n.shift());if(this._active=!1,o){for(;r=n.shift();)r.unsubscribe();throw o}},e}(Tr);var le=function(t){fe(e,t);function e(r,n){r===void 0&&(r=Ar),n===void 0&&(n=1/0);var o=t.call(this,r,function(){return o.frame})||this;return o.maxFrames=n,o.frame=0,o.index=-1,o}return e.prototype.flush=function(){for(var r=this,n=r.actions,o=r.maxFrames,i,a;(a=n[0])&&a.delay<=o&&(n.shift(),this.frame=a.delay,!(i=a.execute(a.state,a.delay))););if(i){for(;a=n.shift();)a.unsubscribe();throw i}},e.frameTimeFactor=10,e}(ce);var Ar=function(t){fe(e,t);function e(r,n,o){o===void 0&&(o=r.index+=1);var i=t.call(this,r,n)||this;return i.scheduler=r,i.work=n,i.index=o,i.active=!0,i.index=r.index=o,i}return e.prototype.schedule=function(r,n){if(n===void 0&&(n=0),Number.isFinite(n)){if(!this.id)return t.prototype.schedule.call(this,r,n);this.active=!1;var o=new e(this.scheduler,this.work);return this.add(o),o.schedule(r,n)}else return g.EMPTY},e.prototype.requestAsyncId=function(r,n,o){o===void 0&&(o=0),this.delay=r.frame+o;var i=r.actions;return i.push(this),i.sort(e.sortActions),1},e.prototype.recycleAsyncId=function(r,n,o){o===void 0&&(o=0)},e.prototype._execute=function(r,n){if(this.active===!0)return t.prototype._execute.call(this,r,n)},e.sortActions=function(r,n){return r.delay===n.delay?r.index===n.index?0:r.index>n.index?1:-1:r.delay>n.delay?1:-1},e}(ue);var hr={now:function(){return(hr.delegate||performance).now()},delegate:void 0};import{__read as pe,__spreadArray as me}from"tslib";var Y={schedule:function(t){var e=requestAnimationFrame,r=cancelAnimationFrame,n=Y.delegate;n&&(e=n.requestAnimationFrame,r=n.cancelAnimationFrame);var o=e(function(i){r=void 0,t(i)});return new g(function(){return r?.(o)})},requestAnimationFrame:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=Y.delegate;return(r?.requestAnimationFrame||requestAnimationFrame).apply(void 0,me([],pe(t)))},cancelAnimationFrame:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=Y.delegate;return(r?.cancelAnimationFrame||cancelAnimationFrame).apply(void 0,me([],pe(t)))},delegate:void 0};import{__read as Qe,__spreadArray as We}from"tslib";var Je=1,Fr,Or={};function de(t){return t in Or?(delete Or[t],!0):!1}var kr={setImmediate:function(t){var e=Je++;return Or[e]=!0,Fr||(Fr=Promise.resolve()),Fr.then(function(){return de(e)&&t()}),e},clearImmediate:function(t){de(t)}};var Ze=kr.setImmediate,Ke=kr.clearImmediate,B={setImmediate:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=B.delegate;return(r?.setImmediate||Ze).apply(void 0,We([],Qe(t)))},clearImmediate:function(t){var e=B.delegate;return(e?.clearImmediate||Ke)(t)},delegate:void 0};var et=750,tt=function(t){rt(e,t);function e(r){var n=t.call(this,Ar,et)||this;return n.assertDeepEqual=r,n.hotObservables=[],n.coldObservables=[],n.flushTests=[],n.runMode=!1,n}return e.prototype.createTime=function(r){var n=this.runMode?r.trim().indexOf("|"):r.indexOf("|");if(n===-1)throw new Error("marble diagram for time should have a completion marker \"|\"");return n*e.frameTimeFactor},e.prototype.createColdObservable=function(r,n,o){if(r.indexOf("^")!==-1)throw new Error("cold observable cannot have subscription offset \"^\"");if(r.indexOf("!")!==-1)throw new Error("cold observable cannot have unsubscription marker \"!\"");var i=e.parseMarbles(r,n,o,void 0,this.runMode),a=new dr(i,this);return this.coldObservables.push(a),a},e.prototype.createHotObservable=function(r,n,o){if(r.indexOf("!")!==-1)throw new Error("hot observable cannot have unsubscription marker \"!\"");var i=e.parseMarbles(r,n,o,void 0,this.runMode),a=new Ir(i,this);return this.hotObservables.push(a),a},e.prototype.materializeInnerObservable=function(r,n){var o=this,i=[];return r.subscribe({next:function(a){i.push({frame:o.frame-n,notification:M(a)})},error:function(a){i.push({frame:o.frame-n,notification:C(a)})},complete:function(){i.push({frame:o.frame-n,notification:L})}}),i},e.prototype.expectObservable=function(r,n){var o=this;n===void 0&&(n=null);var i=[],a={actual:i,ready:!1},s=e.parseMarblesAsSubscriptions(n,this.runMode),u=s.subscribedFrame===1/0?0:s.subscribedFrame,f=s.unsubscribedFrame,c;this.schedule(function(){c=r.subscribe({next:function(p){var v=p instanceof b?o.materializeInnerObservable(p,o.frame):p;i.push({frame:o.frame,notification:M(v)})},error:function(p){i.push({frame:o.frame,notification:C(p)})},complete:function(){i.push({frame:o.frame,notification:L})}})},u),f!==1/0&&this.schedule(function(){return c.unsubscribe()},f),this.flushTests.push(a);var d=this.runMode;return{toBe:function(p,v,h){a.ready=!0,a.expected=e.parseMarbles(p,v,h,!0,d)},toEqual:function(p){a.ready=!0,a.expected=[],o.schedule(function(){c=p.subscribe({next:function(v){var h=v instanceof b?o.materializeInnerObservable(v,o.frame):v;a.expected.push({frame:o.frame,notification:M(h)})},error:function(v){a.expected.push({frame:o.frame,notification:C(v)})},complete:function(){a.expected.push({frame:o.frame,notification:L})}})},u)}}},e.prototype.expectSubscriptions=function(r){var n={actual:r,ready:!1};this.flushTests.push(n);var o=this.runMode;return{toBe:function(i){var a=typeof i=="string"?[i]:i;n.ready=!0,n.expected=a.map(function(s){return e.parseMarblesAsSubscriptions(s,o)}).filter(function(s){return s.subscribedFrame!==1/0})}}},e.prototype.flush=function(){for(var r=this,n=this.hotObservables;n.length>0;)n.shift().setup();t.prototype.flush.call(this),this.flushTests=this.flushTests.filter(function(o){return o.ready?(r.assertDeepEqual(o.actual,o.expected),!1):!0})},e.parseMarblesAsSubscriptions=function(r,n){var o=this;if(n===void 0&&(n=!1),typeof r!="string")return new N(1/0);for(var i=ve([],he(r)),a=i.length,s=-1,u=1/0,f=1/0,c=0,d=function(m){var A=c,w=function(vr){A+=vr*o.frameTimeFactor},S=i[m];switch(S){case" ":n||w(1);break;case"-":w(1);break;case"(":s=c,w(1);break;case")":s=-1,w(1);break;case"^":if(u!==1/0)throw new Error("found a second subscription point '^' in a subscription marble diagram. There can only be one.");u=s>-1?s:c,w(1);break;case"!":if(f!==1/0)throw new Error("found a second unsubscription point '!' in a subscription marble diagram. There can only be one.");f=s>-1?s:c;break;default:if(n&&S.match(/^[0-9]$/)&&(m===0||i[m-1]===" ")){var y=i.slice(m).join(""),_=y.match(/^([0-9]+(?:\.[0-9]+)?)(ms|s|m) /);if(_){m+=_[0].length-1;var x=parseFloat(_[1]),E=_[2],O=void 0;switch(E){case"ms":O=x;break;case"s":O=x*1e3;break;case"m":O=x*1e3*60;break;default:break}w(O/p.frameTimeFactor);break}}throw new Error("there can only be '^' and '!' markers in a subscription marble diagram. Found instead '"+S+"'.")}c=A,v=m},p=this,v,h=0;h<a;h++)d(h),h=v;return f<0?new N(u):new N(u,f)},e.parseMarbles=function(r,n,o,i,a){var s=this;if(i===void 0&&(i=!1),a===void 0&&(a=!1),r.indexOf("!")!==-1)throw new Error("conventional marble diagrams cannot have the unsubscription marker \"!\"");for(var u=ve([],he(r)),f=u.length,c=[],d=a?r.replace(/^[ ]+/,"").indexOf("^"):r.indexOf("^"),p=d===-1?0:d*-this.frameTimeFactor,v=typeof n!="object"?function(y){return y}:function(y){return i&&n[y]instanceof dr?n[y].messages:n[y]},h=-1,m=function(y){var _=p,x=function(xe){_+=xe*s.frameTimeFactor},E=void 0,O=u[y];switch(O){case" ":a||x(1);break;case"-":x(1);break;case"(":h=p,x(1);break;case")":h=-1,x(1);break;case"|":E=L,x(1);break;case"^":x(1);break;case"#":E=C(o||"error"),x(1);break;default:if(a&&O.match(/^[0-9]$/)&&(y===0||u[y-1]===" ")){var vr=u.slice(y).join(""),G=vr.match(/^([0-9]+(?:\.[0-9]+)?)(ms|s|m) /);if(G){y+=G[0].length-1;var br=parseFloat(G[1]),ye=G[2],z=void 0;switch(ye){case"ms":z=br;break;case"s":z=br*1e3;break;case"m":z=br*1e3*60;break;default:break}x(z/A.frameTimeFactor);break}}E=M(v(O)),x(1);break}E&&c.push({frame:h>-1?h:p,notification:E}),p=_,w=y},A=this,w,S=0;S<f;S++)m(S),S=w;return c},e.prototype.createAnimator=function(){var r=this;if(!this.runMode)throw new Error("animate() must only be used in run mode");var n=0,o,i={requestAnimationFrame:function(s){if(!o)throw new Error("animate() was not called within run()");var u=++n;return o.set(u,s),u},cancelAnimationFrame:function(s){if(!o)throw new Error("animate() was not called within run()");o.delete(s)}},a=function(s){var u,f;if(o)throw new Error("animate() must not be called more than once within run()");if(/[|#]/.test(s))throw new Error("animate() must not complete or error");o=new Map;var c=e.parseMarbles(s,void 0,void 0,void 0,!0);try{for(var d=be(c),p=d.next();!p.done;p=d.next()){var v=p.value;r.schedule(function(){var h,m,A=r.now(),w=Array.from(o.values());o.clear();try{for(var S=(h=void 0,be(w)),y=S.next();!y.done;y=S.next()){var _=y.value;_(A)}}catch(x){h={error:x}}finally{try{y&&!y.done&&(m=S.return)&&m.call(S)}finally{if(h)throw h.error}}},v.frame)}}catch(h){u={error:h}}finally{try{p&&!p.done&&(f=d.return)&&f.call(d)}finally{if(u)throw u.error}}};return{animate:a,delegate:i}},e.prototype.createDelegates=function(){var r=this,n=0,o=new Map,i=function(){var f=r.now(),c=Array.from(o.values()),d=c.filter(function(x){var E=x.due;return E<=f}),p=d.filter(function(x){var E=x.type;return E==="immediate"});if(p.length>0){var v=p[0],h=v.handle,m=v.handler;o.delete(h),m();return}var A=d.filter(function(x){var E=x.type;return E==="interval"});if(A.length>0){var w=A[0],S=w.duration,m=w.handler;w.due=f+S,w.subscription=r.schedule(i,S),m();return}var y=d.filter(function(x){var E=x.type;return E==="timeout"});if(y.length>0){var _=y[0],h=_.handle,m=_.handler;o.delete(h),m();return}throw new Error("Expected a due immediate or interval")},a={setImmediate:function(f){var c=++n;return o.set(c,{due:r.now(),duration:0,handle:c,handler:f,subscription:r.schedule(i,0),type:"immediate"}),c},clearImmediate:function(f){var c=o.get(f);c&&(c.subscription.unsubscribe(),o.delete(f))}},s={setInterval:function(f,c){c===void 0&&(c=0);var d=++n;return o.set(d,{due:r.now()+c,duration:c,handle:d,handler:f,subscription:r.schedule(i,c),type:"interval"}),d},clearInterval:function(f){var c=o.get(f);c&&(c.subscription.unsubscribe(),o.delete(f))}},u={setTimeout:function(f,c){c===void 0&&(c=0);var d=++n;return o.set(d,{due:r.now()+c,duration:c,handle:d,handler:f,subscription:r.schedule(i,c),type:"timeout"}),d},clearTimeout:function(f){var c=o.get(f);c&&(c.subscription.unsubscribe(),o.delete(f))}};return{immediate:a,interval:s,timeout:u}},e.prototype.run=function(r){var n=e.frameTimeFactor,o=this.maxFrames;e.frameTimeFactor=1,this.maxFrames=1/0,this.runMode=!0;var i=this.createAnimator(),a=this.createDelegates();Y.delegate=i.delegate,V.delegate=this,B.delegate=a.immediate,k.delegate=a.interval,F.delegate=a.timeout,hr.delegate=this;var s={cold:this.createColdObservable.bind(this),hot:this.createHotObservable.bind(this),flush:this.flush.bind(this),time:this.createTime.bind(this),expectObservable:this.expectObservable.bind(this),expectSubscriptions:this.expectSubscriptions.bind(this),animate:i.animate};try{var u=r(s);return this.flush(),u}finally{e.frameTimeFactor=n,this.maxFrames=o,this.runMode=!1,Y.delegate=void 0,V.delegate=void 0,B.delegate=void 0,k.delegate=void 0,F.delegate=void 0,hr.delegate=void 0}},e.frameTimeFactor=10,e}(le);export{tt as TestScheduler};