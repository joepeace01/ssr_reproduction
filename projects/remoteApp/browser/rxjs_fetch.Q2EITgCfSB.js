import{__assign as sr,__rest as Ur}from"tslib";import{__extends as dr}from"tslib";import{__extends as J}from"tslib";function c(r){return typeof r=="function"}import{__read as C,__spreadArray as D,__values as M}from"tslib";function R(r){var t=function(o){Error.call(o),o.stack=new Error().stack},e=r(t);return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var E=R(function(r){return function(e){r(this),this.message=e?e.length+` errors occurred during unsubscription:
`+e.map(function(o,n){return n+1+") "+o.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e}});function P(r,t){if(r){var e=r.indexOf(t);0<=e&&r.splice(e,1)}}var w=function(){function r(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}return r.prototype.unsubscribe=function(){var t,e,o,n,i;if(!this.closed){this.closed=!0;var a=this._parentage;if(a)if(this._parentage=null,Array.isArray(a))try{for(var s=M(a),u=s.next();!u.done;u=s.next()){var p=u.value;p.remove(this)}}catch(f){t={error:f}}finally{try{u&&!u.done&&(e=s.return)&&e.call(s)}finally{if(t)throw t.error}}else a.remove(this);var h=this.initialTeardown;if(c(h))try{h()}catch(f){i=f instanceof E?f.errors:[f]}var x=this._finalizers;if(x){this._finalizers=null;try{for(var m=M(x),S=m.next();!S.done;S=m.next()){var cr=S.value;try{Y(cr)}catch(f){i=i??[],f instanceof E?i=D(D([],C(i)),C(f.errors)):i.push(f)}}}catch(f){o={error:f}}finally{try{S&&!S.done&&(n=m.return)&&n.call(m)}finally{if(o)throw o.error}}}if(i)throw new E(i)}},r.prototype.add=function(t){var e;if(t&&t!==this)if(this.closed)Y(t);else{if(t instanceof r){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=(e=this._finalizers)!==null&&e!==void 0?e:[]).push(t)}},r.prototype._hasParent=function(t){var e=this._parentage;return e===t||Array.isArray(e)&&e.includes(t)},r.prototype._addParent=function(t){var e=this._parentage;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t},r.prototype._removeParent=function(t){var e=this._parentage;e===t?this._parentage=null:Array.isArray(e)&&P(e,t)},r.prototype.remove=function(t){var e=this._finalizers;e&&P(e,t),t instanceof r&&t._removeParent(this)},r.EMPTY=function(){var t=new r;return t.closed=!0,t}(),r}();var Nr=w.EMPTY;function T(r){return r instanceof w||r&&"closed"in r&&c(r.remove)&&c(r.add)&&c(r.unsubscribe)}function Y(r){c(r)?r():r.unsubscribe()}var l={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};import{__read as G,__spreadArray as H}from"tslib";var b={setTimeout:function(r,t){for(var e=[],o=2;o<arguments.length;o++)e[o-2]=arguments[o];var n=b.delegate;return n?.setTimeout?n.setTimeout.apply(n,H([r,t],G(e))):setTimeout.apply(void 0,H([r,t],G(e)))},clearTimeout:function(r){var t=b.delegate;return(t?.clearTimeout||clearTimeout)(r)},delegate:void 0};function I(r){b.setTimeout(function(){var t=l.onUnhandledError;if(t)t(r);else throw r})}function F(){}var B=function(){return O("C",void 0,void 0)}();function N(r){return O("E",void 0,r)}function V(r){return O("N",r,void 0)}function O(r,t,e){return{kind:r,value:t,error:e}}var v=null;function j(r){if(l.useDeprecatedSynchronousErrorHandling){var t=!v;if(t&&(v={errorThrown:!1,error:null}),r(),t){var e=v,o=e.errorThrown,n=e.error;if(v=null,o)throw n}}else r()}function q(r){l.useDeprecatedSynchronousErrorHandling&&v&&(v.errorThrown=!0,v.error=r)}var g=function(r){J(t,r);function t(e){var o=r.call(this)||this;return o.isStopped=!1,e?(o.destination=e,T(e)&&e.add(o)):o.destination=mr,o}return t.create=function(e,o,n){return new A(e,o,n)},t.prototype.next=function(e){this.isStopped?L(V(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?L(N(e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?L(B,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,r.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(w);var fr=Function.prototype.bind;function U(r,t){return fr.call(r,t)}var lr=function(){function r(t){this.partialObserver=t}return r.prototype.next=function(t){var e=this.partialObserver;if(e.next)try{e.next(t)}catch(o){_(o)}},r.prototype.error=function(t){var e=this.partialObserver;if(e.error)try{e.error(t)}catch(o){_(o)}else _(t)},r.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(e){_(e)}},r}(),A=function(r){J(t,r);function t(e,o,n){var i=r.call(this)||this,a;if(c(e)||!e)a={next:e??void 0,error:o??void 0,complete:n??void 0};else{var s;i&&l.useDeprecatedNextContext?(s=Object.create(e),s.unsubscribe=function(){return i.unsubscribe()},a={next:e.next&&U(e.next,s),error:e.error&&U(e.error,s),complete:e.complete&&U(e.complete,s)}):a=e}return i.destination=new lr(a),i}return t}(g);function _(r){l.useDeprecatedSynchronousErrorHandling?q(r):I(r)}function pr(r){throw r}function L(r,t){var e=l.onStoppedNotification;e&&b.setTimeout(function(){return e(r,t)})}var mr={closed:!0,next:F,error:pr,complete:F};function K(r,t,e,o,n){return new hr(r,t,e,o,n)}var hr=function(r){dr(t,r);function t(e,o,n,i,a,s){var u=r.call(this,e)||this;return u.onFinalize=a,u.shouldUnsubscribe=s,u._next=o?function(p){try{o(p)}catch(h){e.error(h)}}:r.prototype._next,u._error=i?function(p){try{i(p)}catch(h){e.error(h)}finally{this.unsubscribe()}}:r.prototype._error,u._complete=n?function(){try{n()}catch(p){e.error(p)}finally{this.unsubscribe()}}:r.prototype._complete,u}return t.prototype.unsubscribe=function(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var o=this.closed;r.prototype.unsubscribe.call(this),!o&&((e=this.onFinalize)===null||e===void 0||e.call(this))}},t}(g);var y=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function Q(r){return r}function X(r){return r.length===0?Q:r.length===1?r[0]:function(e){return r.reduce(function(o,n){return n(o)},e)}}var d=function(){function r(t){t&&(this._subscribe=t)}return r.prototype.lift=function(t){var e=new r;return e.source=this,e.operator=t,e},r.prototype.subscribe=function(t,e,o){var n=this,i=br(t)?t:new A(t,e,o);return j(function(){var a=n,s=a.operator,u=a.source;i.add(s?s.call(i,u):u?n._subscribe(i):n._trySubscribe(i))}),i},r.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){t.error(e)}},r.prototype.forEach=function(t,e){var o=this;return e=Z(e),new e(function(n,i){var a=new A({next:function(s){try{t(s)}catch(u){i(u),a.unsubscribe()}},error:i,complete:n});o.subscribe(a)})},r.prototype._subscribe=function(t){var e;return(e=this.source)===null||e===void 0?void 0:e.subscribe(t)},r.prototype[y]=function(){return this},r.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return X(t)(this)},r.prototype.toPromise=function(t){var e=this;return t=Z(t),new t(function(o,n){var i;e.subscribe(function(a){return i=a},function(a){return n(a)},function(){return o(i)})})},r.create=function(t){return new r(t)},r}();function Z(r){var t;return(t=r??l.Promise)!==null&&t!==void 0?t:Promise}function vr(r){return r&&c(r.next)&&c(r.error)&&c(r.complete)}function br(r){return r&&r instanceof g||vr(r)&&T(r)}import{__asyncValues as gr,__awaiter as Er,__generator as wr,__values as Tr}from"tslib";var $=function(r){return r&&typeof r.length=="number"&&typeof r!="function"};function z(r){return c(r?.then)}function W(r){return c(r[y])}function rr(r){return Symbol.asyncIterator&&c(r?.[Symbol.asyncIterator])}function er(r){return new TypeError("You provided "+(r!==null&&typeof r=="object"?"an invalid object":"'"+r+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function yr(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var tr=yr();function or(r){return c(r?.[tr])}import{__asyncGenerator as xr,__await as k,__generator as Sr}from"tslib";function nr(r){return xr(this,arguments,function(){var e,o,n,i;return Sr(this,function(a){switch(a.label){case 0:e=r.getReader(),a.label=1;case 1:a.trys.push([1,,9,10]),a.label=2;case 2:return[4,k(e.read())];case 3:return o=a.sent(),n=o.value,i=o.done,i?[4,k(void 0)]:[3,5];case 4:return[2,a.sent()];case 5:return[4,k(n)];case 6:return[4,a.sent()];case 7:return a.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}})})}function ir(r){return c(r?.getReader)}function ar(r){if(r instanceof d)return r;if(r!=null){if(W(r))return Ir(r);if($(r))return _r(r);if(z(r))return Ar(r);if(rr(r))return ur(r);if(or(r))return Pr(r);if(ir(r))return Fr(r)}throw er(r)}function Ir(r){return new d(function(t){var e=r[y]();if(c(e.subscribe))return e.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function _r(r){return new d(function(t){for(var e=0;e<r.length&&!t.closed;e++)t.next(r[e]);t.complete()})}function Ar(r){return new d(function(t){r.then(function(e){t.closed||(t.next(e),t.complete())},function(e){return t.error(e)}).then(null,I)})}function Pr(r){return new d(function(t){var e,o;try{for(var n=Tr(r),i=n.next();!i.done;i=n.next()){var a=i.value;if(t.next(a),t.closed)return}}catch(s){e={error:s}}finally{try{i&&!i.done&&(o=n.return)&&o.call(n)}finally{if(e)throw e.error}}t.complete()})}function ur(r){return new d(function(t){Or(r,t).catch(function(e){return t.error(e)})})}function Fr(r){return ur(nr(r))}function Or(r,t){var e,o,n,i;return Er(this,void 0,void 0,function(){var a,s;return wr(this,function(u){switch(u.label){case 0:u.trys.push([0,5,6,11]),e=gr(r),u.label=1;case 1:return[4,e.next()];case 2:if(o=u.sent(),!!o.done)return[3,4];if(a=o.value,t.next(a),t.closed)return[2];u.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return s=u.sent(),n={error:s},[3,11];case 6:return u.trys.push([6,,9,10]),o&&!o.done&&(i=e.return)?[4,i.call(e)]:[3,8];case 7:u.sent(),u.label=8;case 8:return[3,10];case 9:if(n)throw n.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}})})}function Lr(r,t){t===void 0&&(t={});var e=t.selector,o=Ur(t,["selector"]);return new d(function(n){var i=new AbortController,a=i.signal,s=!0,u=o.signal;if(u)if(u.aborted)i.abort();else{var p=function(){a.aborted||i.abort()};u.addEventListener("abort",p),n.add(function(){return u.removeEventListener("abort",p)})}var h=sr(sr({},o),{signal:a}),x=function(m){s=!1,n.error(m)};return fetch(r,h).then(function(m){e?ar(e(m)).subscribe(K(n,void 0,function(){s=!1,n.complete()},x)):(s=!1,n.next(m),n.complete())}).catch(x),function(){s&&i.abort()}})}export{Lr as fromFetch};